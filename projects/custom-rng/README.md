# Custom RNG (Random Number Generator)

ì»¤ìŠ¤í…€ ë‚œìˆ˜ ìƒì„±ê¸° í”„ë¡œì íŠ¸ì…ë‹ˆë‹¤. ì´ í”„ë¡œì íŠ¸ëŠ” ë¸”ë¡ì²´ì¸ì—ì„œ ì•ˆì „í•˜ê³  ê²€ì¦ ê°€ëŠ¥í•œ ë‚œìˆ˜ë¥¼ ìƒì„±í•˜ê¸° ìœ„í•œ ìŠ¤ë§ˆíŠ¸ ì»¨íŠ¸ë™íŠ¸ ì‹œìŠ¤í…œì„ êµ¬í˜„í•©ë‹ˆë‹¤.

## ğŸ“‹ ëª©ì°¨

- [ê°œìš”](#ê°œìš”)
- [ì•„í‚¤í…ì²˜](#ì•„í‚¤í…ì²˜)
- [ì»¨íŠ¸ë™íŠ¸ ì„¤ëª…](#ì»¨íŠ¸ë™íŠ¸-ì„¤ëª…)
- [ì„¤ì¹˜ ë° ì‹¤í–‰](#ì„¤ì¹˜-ë°-ì‹¤í–‰)
- [í…ŒìŠ¤íŠ¸](#í…ŒìŠ¤íŠ¸)
- [ë³´ì•ˆ ê³ ë ¤ì‚¬í•­](#ë³´ì•ˆ-ê³ ë ¤ì‚¬í•­)
- [ë¼ì´ì„¼ìŠ¤](#ë¼ì´ì„¼ìŠ¤)

## ğŸ¯ ê°œìš”

ì´ í”„ë¡œì íŠ¸ëŠ” ë¸”ë¡ì²´ì¸ í™˜ê²½ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ì»¤ìŠ¤í…€ ë‚œìˆ˜ ìƒì„±ê¸°(RNG)ë¥¼ êµ¬í˜„í•©ë‹ˆë‹¤. ì£¼ìš” íŠ¹ì§•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

- **ì„œëª… ê¸°ë°˜ ê²€ì¦**: EIP-712ë¥¼ ì‚¬ìš©í•œ ì„œëª… ê²€ì¦ìœ¼ë¡œ ë‚œìˆ˜ì˜ ë¬´ê²°ì„± ë³´ì¥
- **ë‹¤ë‹¨ê³„ ì—”íŠ¸ë¡œí”¼**: ë¼ìš´ë“œ ì§„í–‰ ì¤‘ ì¶”ê°€ ì—”íŠ¸ë¡œí”¼ë¥¼ í†µí•œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„± í™•ë³´
- **íˆ¬ëª…ì„±**: ëª¨ë“  ê³¼ì •ì´ ë¸”ë¡ì²´ì¸ì— ê¸°ë¡ë˜ì–´ ê²€ì¦ ê°€ëŠ¥
- **ë¶„ë¦¬ëœ ì•„í‚¤í…ì²˜**: Main ì»¨íŠ¸ë™íŠ¸ì™€ Rng ì»¨íŠ¸ë™íŠ¸ì˜ ì—­í•  ë¶„ë¦¬

## ğŸ—ï¸ ì•„í‚¤í…ì²˜

### ì»¨íŠ¸ë™íŠ¸ êµ¬ì¡°

```
Main.sol (ë¼ìš´ë“œ ê´€ë¦¬)
â”œâ”€â”€ ë¼ìš´ë“œ ìƒëª…ì£¼ê¸° ê´€ë¦¬
â”œâ”€â”€ Rng ì»¨íŠ¸ë™íŠ¸ì™€ì˜ ìƒí˜¸ì‘ìš©
â””â”€â”€ ìƒíƒœ ê´€ë¦¬

Rng.sol (ë‚œìˆ˜ ìƒì„±)
â”œâ”€â”€ ì„œëª… ê²€ì¦
â”œâ”€â”€ ì—”íŠ¸ë¡œí”¼ ì¶”ê°€
â””â”€â”€ ìµœì¢… ë‚œìˆ˜ ìƒì„±
```

### ë¼ìš´ë“œ ìƒëª…ì£¼ê¸°

1. **NotStarted** â†’ ë¼ìš´ë“œ ì‹œì‘ ì „
2. **Proceeding** â†’ ë¼ìš´ë“œ ì§„í–‰ ì¤‘ (startRound)
3. **Drawing** â†’ ê°œí‘œ ì¤‘ (endRound)
4. **Claiming** â†’ ë‹¹ì²¨ê¸ˆ ìˆ˜ë ¹ ì¤‘ (settleRound)
5. **Ended** â†’ ì¢…ë£Œ

## ğŸ“„ ì»¨íŠ¸ë™íŠ¸ ì„¤ëª…

### Main.sol

ë¼ìš´ë“œì˜ ì „ì²´ ìƒëª…ì£¼ê¸°ë¥¼ ê´€ë¦¬í•˜ëŠ” ë©”ì¸ ì»¨íŠ¸ë™íŠ¸ì…ë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥

- `startRound(uint256 _roundId, bytes calldata _signature)`: ë¼ìš´ë“œ ì‹œì‘
- `endRound(uint256 _roundId)`: ë¼ìš´ë“œ ì¢…ë£Œ ë° ì—”íŠ¸ë¡œí”¼ ì¶”ê°€
- `settleRound(uint256 _roundId, uint256 _randSeed)`: ë¼ìš´ë“œ ì •ì‚° ë° ìµœì¢… ë‚œìˆ˜ í™•ì •
- `getRoundStatus(uint256 _roundId)`: ë¼ìš´ë“œ ìƒíƒœ ì¡°íšŒ

### Rng.sol

ì‹¤ì œ ë‚œìˆ˜ ìƒì„±ì„ ë‹´ë‹¹í•˜ëŠ” ì»¨íŠ¸ë™íŠ¸ì…ë‹ˆë‹¤.

#### ì£¼ìš” ê¸°ëŠ¥

- `commit(uint256 _roundId, bytes calldata _signature)`: ì„œëª…ëœ ì‹œë“œ ì €ì¥
- `sealEntropy(uint256 _roundId, address _ender)`: ì—”íŠ¸ë¡œí”¼ ì¶”ê°€
- `reveal(uint256 _roundId, uint256 _randSeed)`: ìµœì¢… ë‚œìˆ˜ ìƒì„± ë° ê²€ì¦

#### ë‚œìˆ˜ ìƒì„± ê³¼ì •

1. **Commit ë‹¨ê³„**: ì„œëª…ëœ ì‹œë“œ ì €ì¥
2. **Seal ë‹¨ê³„**: ë¸”ë¡ í•´ì‹œë¥¼ ì´ìš©í•œ ì—”íŠ¸ë¡œí”¼ ì¶”ê°€
3. **Reveal ë‹¨ê³„**: ì„œëª… ê²€ì¦ í›„ ìµœì¢… ë‚œìˆ˜ ìƒì„±

```
ìµœì¢… ë‚œìˆ˜ = keccak256(
    ì‹œë“œ + ì¢…ë£Œìì£¼ì†Œ + ì†”íŠ¸ + ì—”íŠ¸ë¡œí”¼1 + ì—”íŠ¸ë¡œí”¼2
)
```

## ğŸš€ ì„¤ì¹˜ ë° ì‹¤í–‰

### í•„ìˆ˜ ìš”êµ¬ì‚¬í•­

- Node.js 18+
- pnpm (ê¶Œì¥) ë˜ëŠ” npm
- Foundry (í…ŒìŠ¤íŠ¸ìš©)

### ì„¤ì¹˜

```bash
# ì˜ì¡´ì„± ì„¤ì¹˜
pnpm install

# Foundry ì„¤ì¹˜ (ì„ íƒì‚¬í•­)
curl -L https://foundry.paradigm.xyz | bash
foundryup
```

### ì»´íŒŒì¼

```bash
# Hardhatìœ¼ë¡œ ì»´íŒŒì¼
pnpm compile

# Foundryë¡œ ì»´íŒŒì¼ (ì„ íƒì‚¬í•­)
forge build
```

### ë°°í¬

```bash
# ë¡œì»¬ ë„¤íŠ¸ì›Œí¬ ì‹¤í–‰
npx hardhat node

# ë°°í¬
pnpm deploy
```

## ğŸ§ª í…ŒìŠ¤íŠ¸

### Hardhat í…ŒìŠ¤íŠ¸

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
pnpm test

# íŠ¹ì • í…ŒìŠ¤íŠ¸ ì‹¤í–‰
npx hardhat test test/Main.debug.test.js
npx hardhat test test/Rng.debug.test.js
npx hardhat test test/Integration.debug.test.js
```

### Foundry í…ŒìŠ¤íŠ¸

```bash
# ëª¨ë“  í…ŒìŠ¤íŠ¸ ì‹¤í–‰
forge test

# íŠ¹ì • í…ŒìŠ¤íŠ¸ ì‹¤í–‰
forge test --match-contract Main
forge test --match-contract Rng
forge test --match-contract Integration

# ê°€ìŠ¤ ì‚¬ìš©ëŸ‰ê³¼ í•¨ê»˜ í…ŒìŠ¤íŠ¸
forge test --gas-report
```

## ğŸ”’ ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

### ì„œëª… ê²€ì¦

- EIP-712 í‘œì¤€ì„ ì‚¬ìš©í•œ íƒ€ì… ì•ˆì „í•œ ì„œëª… ê²€ì¦
- ì„œëª…ì ì£¼ì†Œ ê²€ì¦ìœ¼ë¡œ ë¬´ë‹¨ ì ‘ê·¼ ë°©ì§€

### ì—”íŠ¸ë¡œí”¼ ì†ŒìŠ¤

- ë¸”ë¡ í•´ì‹œë¥¼ ì´ìš©í•œ ì¶”ê°€ ì—”íŠ¸ë¡œí”¼
- ë‹¤ì¤‘ ì—”íŠ¸ë¡œí”¼ ì†ŒìŠ¤ë¡œ ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥ì„± í™•ë³´
- ê³¼ê±° ë¸”ë¡ í•´ì‹œ ì‚¬ìš©ìœ¼ë¡œ ì¡°ì‘ ë°©ì§€

### ì ‘ê·¼ ì œì–´

- `onlyOwner` ìˆ˜ì •ìë¡œ ê´€ë¦¬ì ê¸°ëŠ¥ ë³´í˜¸
- `onlyMain` ìˆ˜ì •ìë¡œ Rng ì»¨íŠ¸ë™íŠ¸ ì ‘ê·¼ ì œí•œ

## ğŸ“¦ í”„ë¡œì íŠ¸ êµ¬ì¡°

```
custom-rng/
â”œâ”€â”€ contracts/
â”‚   â”œâ”€â”€ Main.sol          # ë¼ìš´ë“œ ê´€ë¦¬ ì»¨íŠ¸ë™íŠ¸
â”‚   â””â”€â”€ Rng.sol           # ë‚œìˆ˜ ìƒì„± ì»¨íŠ¸ë™íŠ¸
â”œâ”€â”€ test/
â”‚   â”œâ”€â”€ Main.debug.test.js
â”‚   â”œâ”€â”€ Rng.debug.test.js
â”‚   â””â”€â”€ Integration.debug.test.js
â”œâ”€â”€ foundry/
â”‚   â””â”€â”€ test/
â”‚       â”œâ”€â”€ Main.t.sol
â”‚       â”œâ”€â”€ Rng.t.sol
â”‚       â””â”€â”€ Integration.t.sol
â”œâ”€â”€ hardhat.config.js
â”œâ”€â”€ foundry.toml
â””â”€â”€ package.json
```

## ğŸ”§ ì„¤ì •

### Hardhat ì„¤ì •

- Solidity ë²„ì „: 0.8.28
- EVM ë²„ì „: Cancun (0.8.28+ ì§€ì›)
- ìµœì í™”: í™œì„±í™” (200 runs)

### Foundry ì„¤ì •

- ì†ŒìŠ¤ ë””ë ‰í† ë¦¬: `contracts/`
- í…ŒìŠ¤íŠ¸ ë””ë ‰í† ë¦¬: `foundry/test/`
- ì¶œë ¥ ë””ë ‰í† ë¦¬: `foundry/out/`

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### 1. ì»¨íŠ¸ë™íŠ¸ ë°°í¬

```javascript
// Main ì»¨íŠ¸ë™íŠ¸ ë°°í¬
const Main = await ethers.getContractFactory("Main");
const main = await Main.deploy();

// Rng ì»¨íŠ¸ë™íŠ¸ ë°°í¬
const Rng = await ethers.getContractFactory("Rng");
const rng = await Rng.deploy(main.address, signer.address);

// Main ì»¨íŠ¸ë™íŠ¸ì— Rng ì£¼ì†Œ ì„¤ì •
await main.setContracts([rng.address]);
```

### 2. ë¼ìš´ë“œ ì‹¤í–‰

```javascript
// 1. ë¼ìš´ë“œ ì‹œì‘
await main.startRound(1, signature);

// 2. ë¼ìš´ë“œ ì¢…ë£Œ
await main.endRound(1);

// 3. ë¼ìš´ë“œ ì •ì‚°
await main.settleRound(1, originalSeed);
```

## ğŸ¤ ê¸°ì—¬

1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Commit your changes (`git commit -m 'Add some amazing feature'`)
4. Push to the branch (`git push origin feature/amazing-feature`)
5. Open a Pull Request

## ğŸ“„ ë¼ì´ì„¼ìŠ¤

ì´ í”„ë¡œì íŠ¸ëŠ” MIT ë¼ì´ì„¼ìŠ¤ í•˜ì— ë°°í¬ë©ë‹ˆë‹¤. ìì„¸í•œ ë‚´ìš©ì€ [LICENSE](../LICENSE) íŒŒì¼ì„ ì°¸ì¡°í•˜ì„¸ìš”.

## ğŸ‘¨â€ğŸ’» ì‘ì„±ì

**hlibbc**

---

**ì£¼ì˜**: ì´ í”„ë¡œì íŠ¸ëŠ” êµìœ¡ ë° ì—°êµ¬ ëª©ì ìœ¼ë¡œ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤. í”„ë¡œë•ì…˜ í™˜ê²½ì—ì„œ ì‚¬ìš©í•˜ê¸° ì „ì— ì¶©ë¶„í•œ ë³´ì•ˆ ê°ì‚¬ë¥¼ ë°›ìœ¼ì‹œê¸° ë°”ëë‹ˆë‹¤. 